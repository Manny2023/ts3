<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TS DOCENTES</title>
    <link rel="icon" href="https://i.ibb.co/T1jVqPw/favicon-32x32.png" type="image/png">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh; /* Altura completa */
        }
        
        iframe {
            flex-grow: 1; /* Permitir que el iframe crezca */
            border: none; /* Eliminar borde */
        }

        #install-banner {
            background-color: #f8f9fa; /* Fondo claro para visibilidad */
            padding: 10px;
            text-align: center;
            display: none; /* Oculto por defecto */
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging-compat.js"></script>
</head>
<body>
    <iframe src="https://tsdocentesmx.blogspot.com/p/primer-grado.html" width="100%" height="600px"></iframe>
    
    <div id="install-banner">
        <p style="margin: 0;">¡Instala nuestra aplicación para una mejor experiencia!</p>
        <button id="install-button">Instalar</button>
    </div>

    <script src="main.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA4TDdmsxfthFR4PTuBAhEQdutP06i9c2I",
            authDomain: "telesecundaria-ts.firebaseapp.com",
            projectId: "telesecundaria-ts",
            storageBucket: "telesecundaria-ts.appspot.com",
            messagingSenderId: "572048540410",
            appId: "1:572048540410:web:e08e9c3971b191e92cbf43",
            measurementId: "G-T6V43KVHRX"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();

        // Solicitar permiso para notificaciones
        Notification.requestPermission().then(function(permission) {
            if (permission === 'granted') {
                console.log('Permiso de notificaciones concedido.');
                messaging.getToken({ vapidKey: 'qcB9jKz9lOP6YOuk4fvtUG_KHpXv1KdSjqQJdjDZbFs' })
                    .then(function(token) {
                        if (token) {
                            console.log('Token de dispositivo:', token);
                            // Envía el token a tu servidor aquí
                        } else {
                            console.log('No se obtuvo token.');
                        }
                    })
                    .catch(function(err) {
                        console.log('Error al obtener el token de notificación.', err);
                    });
            } else {
                console.log('Permiso para notificaciones denegado.');
            }
        }).catch(function(err) {
            console.log('Error al solicitar permiso para notificaciones:', err);
        });

        // Manejar mensajes en primer plano
        messaging.onMessage(function(payload) {
            console.log('Mensaje recibido. ', payload);
            const notificationTitle = payload.notification.title || 'Título por defecto';
            const notificationOptions = {
                body: payload.notification.body || 'Cuerpo de notificación por defecto',
                icon: payload.notification.icon || 'https://i.ibb.co/T1jVqPw/favicon-32x32.png'
            };

            const notification = new Notification(notificationTitle, notificationOptions);
            
            // Reproducir sonido
            const audio = new Audio('http://www.sonidosmp3gratis.com/sounds/messenger-tono-mensaje-.mp3');
            audio.play().catch(function(err) {
                console.log('Error al reproducir el sonido:', err);
            });
        });

        // Registrar el Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/firebase-messaging-sw.js')
                .then(function(registration) {
                    console.log('Service Worker registrado con éxito:', registration);
                    messaging.useServiceWorker(registration);
                })
                .catch(function(err) {
                    console.log('Error al registrar el Service Worker:', err);
                });
        }

        // Manejo del banner de instalación
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallBanner();
        });

        function showInstallBanner() {
            const installBanner = document.getElementById('install-banner');
            installBanner.style.display = 'block';

            const installButton = document.getElementById('install-button');
            installButton.addEventListener('click', () => {
                installBanner.style.display = 'none';
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('Usuario aceptó la instalación');
                    } else {
                        console.log('Usuario rechazó la instalación');
                    }
                    deferredPrompt = null;
                });
            });
        }
    </script>
</body>
</html>
